//watchify uFab_test.js -t babelify -v --outfile bundle.js

var uFab = require('./uFab');
var handlers = require('./handlers');

var big_ugly_JSON = JSON.parse('{"device": {"name": "transposer_med", "height": 51, "width": 75.8}, "layers": {"c": {"features": ["urn:uuid:7b2f768e-e99f-473d-bc73-47985ee9b0cf", "urn:uuid:7b2f768e-e99f-473d-bc73-47985ee9b0cf", "urn:uuid:946d6532-cf34-4b1d-8675-d93f6b998104", "urn:uuid:946d6532-cf34-4b1d-8675-d93f6b998104", "urn:uuid:0e110548-170e-44cd-9473-1f525ac75c1d", "urn:uuid:0e110548-170e-44cd-9473-1f525ac75c1d", "urn:uuid:55371b2e-150b-4a80-9256-e5b8d7f96c2c", "urn:uuid:55371b2e-150b-4a80-9256-e5b8d7f96c2c", "urn:uuid:5432fd20-c4d8-4e0f-a32b-81867f7a3ff0", "urn:uuid:5432fd20-c4d8-4e0f-a32b-81867f7a3ff0", "urn:uuid:6875b5c1-bd5d-4aca-86b0-97b1bdf24e22", "urn:uuid:6875b5c1-bd5d-4aca-86b0-97b1bdf24e22", "urn:uuid:6a907a99-0bb0-4538-89a6-1c44ff312894", "urn:uuid:6a907a99-0bb0-4538-89a6-1c44ff312894", "urn:uuid:2865a2cd-28c5-42f3-bb0d-4cc91438fb4f", "urn:uuid:2865a2cd-28c5-42f3-bb0d-4cc91438fb4f", "urn:uuid:82e731f3-0452-487b-b694-f33b5acff542", "urn:uuid:82e731f3-0452-487b-b694-f33b5acff542", "urn:uuid:d363683a-d9ac-4980-9d88-8526d6d9dffb", "urn:uuid:d363683a-d9ac-4980-9d88-8526d6d9dffb", "urn:uuid:daeb8b02-782d-48c9-b25d-07043f575c3e", "urn:uuid:daeb8b02-782d-48c9-b25d-07043f575c3e", "urn:uuid:cb4af447-a432-4991-a3db-d58aec3404c2", "urn:uuid:ef6f7d5a-6c6e-40c6-9d53-b39c375f6d14", "urn:uuid:a1b87ff2-1e13-4dc8-bdca-522f47f9a18c", "urn:uuid:38af6c40-ef06-412a-84c4-3b71e5a22f23", "urn:uuid:56cdc545-3fcc-42f0-b9b9-fd3672117808", "urn:uuid:f04653e7-4656-4f2c-8124-983e927b76f4", "urn:uuid:23f653c3-d221-4be0-8e66-d77fbb65674e", "urn:uuid:27f42484-b4b4-4acb-b515-d8e68e7bcd8a", "urn:uuid:fb47ba73-2ead-4fb6-87d4-679f38492f97", "urn:uuid:da122f20-5a39-4378-bf4c-43047f704138", "urn:uuid:7d7379b5-35b4-4a53-9de0-542987c8d881", "urn:uuid:128bd93d-ca0f-4320-b77b-98b660ecee3c", "urn:uuid:68387756-9e52-412c-a91b-c67563e300ba", "urn:uuid:1105d850-f116-449f-989d-82950af38d00"], "ID": "c", "flip": true, "color": "Red", "z_offset": 1.2}, "f": {"features": ["urn:uuid:a07eb02c-1491-44ca-b219-f05f6eea35e7", "urn:uuid:a07eb02c-1491-44ca-b219-f05f6eea35e7", "urn:uuid:48666511-d02a-4440-b901-2448de91f9f3", "urn:uuid:48666511-d02a-4440-b901-2448de91f9f3", "urn:uuid:0d13a06f-2af6-4a69-9f94-47b48fafd9f4", "urn:uuid:0d13a06f-2af6-4a69-9f94-47b48fafd9f4", "urn:uuid:9328da25-a0b7-4e25-9575-039b3bf6f556", "urn:uuid:9328da25-a0b7-4e25-9575-039b3bf6f556", "urn:uuid:c5ac53af-fd28-40ef-b99d-ca06c129ed32", "urn:uuid:c5ac53af-fd28-40ef-b99d-ca06c129ed32", "urn:uuid:f9179d54-62ca-492c-8b6c-589d5617f4fe", "urn:uuid:80e5b6c2-87d8-4f90-a7a5-1cb4bb6d336e", "urn:uuid:40e7709b-75c4-4eeb-901b-e2dfc3b3dffd", "urn:uuid:9d3c60bb-b473-4b03-a5c3-321697dce0fc", "urn:uuid:1a4dd466-ad47-476c-a75a-60d0bdb8fc1e", "urn:uuid:8b93590b-4ebe-4b93-a464-d874436e7186", "urn:uuid:f1905afe-254c-4651-aabe-3c37c47bc939", "urn:uuid:3ff94e71-6db9-4c97-909b-7b483d467a1a", "urn:uuid:6781df12-2f32-4002-9604-4ec71aaed8e5", "urn:uuid:3498af49-23df-49cc-909c-8dab3d4907c7", "urn:uuid:b48c3cb1-3e23-4f4f-a867-c044ee6f7cf7", "urn:uuid:9aff3255-d094-4eee-bc46-5accbb3d2f43", "urn:uuid:dfafadb4-18e0-4375-8455-a25a65acd55c", "urn:uuid:a989e9b2-370c-4422-bfd9-47bad317246b"], "ID": "f", "flip": false, "color": "Blue", "z_offset": 0}}, "features": {"urn:uuid:0d13a06f-2af6-4a69-9f94-47b48fafd9f4": {"ID": "urn:uuid:0d13a06f-2af6-4a69-9f94-47b48fafd9f4", "type": "channel", "layer": "f", "feature_params": {"start": [40.21, 20], "width": 0.41, "height": 0.1, "end": [40.21, 31.02]}}, "urn:uuid:5432fd20-c4d8-4e0f-a32b-81867f7a3ff0": {"ID": "urn:uuid:5432fd20-c4d8-4e0f-a32b-81867f7a3ff0", "type": "channel", "layer": "c", "feature_params": {"start": [40.21, 28.415], "width": 0.41, "height": 0.1, "end": [49.015, 28.415]}}, "urn:uuid:23f653c3-d221-4be0-8e66-d77fbb65674e": {"ID": "urn:uuid:23f653c3-d221-4be0-8e66-d77fbb65674e", "type": "port", "layer": "c", "feature_params": {"radius": 0.7, "height": 0.1, "position": [47.92, 20]}}, "urn:uuid:fb47ba73-2ead-4fb6-87d4-679f38492f97": {"ID": "urn:uuid:fb47ba73-2ead-4fb6-87d4-679f38492f97", "type": "valve", "layer": "c", "feature_params": {"radius2": 1.2, "radius1": 1.4, "height": 0.8999999999999999, "position": [37.11, 20]}}, "urn:uuid:a07eb02c-1491-44ca-b219-f05f6eea35e7": {"ID": "urn:uuid:a07eb02c-1491-44ca-b219-f05f6eea35e7", "type": "channel", "layer": "f", "feature_params": {"start": [30, 20], "width": 0.41, "height": 0.1, "end": [50.42, 20]}}, "urn:uuid:6a907a99-0bb0-4538-89a6-1c44ff312894": {"ID": "urn:uuid:6a907a99-0bb0-4538-89a6-1c44ff312894", "type": "channel", "layer": "c", "feature_params": {"start": [37.11, 20], "width": 0.41, "height": 0.1, "end": [31.405, 20]}}, "urn:uuid:1a4dd466-ad47-476c-a75a-60d0bdb8fc1e": {"ID": "urn:uuid:1a4dd466-ad47-476c-a75a-60d0bdb8fc1e", "type": "via", "layer": "f", "feature_params": {"radius2": 0.7, "radius1": 0.8, "height": 1.0999999999999999, "position": [34.010000000000005, 25.509999999999998]}}, "urn:uuid:1105d850-f116-449f-989d-82950af38d00": {"ID": "urn:uuid:1105d850-f116-449f-989d-82950af38d00", "type": "valve", "layer": "c", "feature_params": {"radius2": 1.2, "radius1": 1.4, "height": 0.8999999999999999, "position": [46.41, 28.415]}}, "urn:uuid:38af6c40-ef06-412a-84c4-3b71e5a22f23": {"ID": "urn:uuid:38af6c40-ef06-412a-84c4-3b71e5a22f23", "type": "port", "layer": "c", "feature_params": {"radius": 0.7, "height": 0.1, "position": [30, 31.02]}}, "urn:uuid:daeb8b02-782d-48c9-b25d-07043f575c3e": {"ID": "urn:uuid:daeb8b02-782d-48c9-b25d-07043f575c3e", "type": "channel", "layer": "c", "feature_params": {"start": [49.015, 22.605], "width": 0.41, "height": 0.1, "end": [50.42, 22.605]}}, "urn:uuid:f1905afe-254c-4651-aabe-3c37c47bc939": {"ID": "urn:uuid:f1905afe-254c-4651-aabe-3c37c47bc939", "type": "via", "layer": "f", "feature_params": {"radius2": 0.7, "radius1": 0.8, "height": 1.0999999999999999, "position": [30, 20]}}, "urn:uuid:7b2f768e-e99f-473d-bc73-47985ee9b0cf": {"ID": "urn:uuid:7b2f768e-e99f-473d-bc73-47985ee9b0cf", "type": "channel", "layer": "c", "feature_params": {"start": [34.010000000000005, 25.509999999999998], "width": 0.41, "height": 0.1, "end": [46.41, 25.509999999999998]}}, "urn:uuid:ef6f7d5a-6c6e-40c6-9d53-b39c375f6d14": {"ID": "urn:uuid:ef6f7d5a-6c6e-40c6-9d53-b39c375f6d14", "type": "port", "layer": "c", "feature_params": {"radius": 0.7, "height": 0.1, "position": [46.41, 25.509999999999998]}}, "urn:uuid:f9179d54-62ca-492c-8b6c-589d5617f4fe": {"ID": "urn:uuid:f9179d54-62ca-492c-8b6c-589d5617f4fe", "type": "port", "layer": "f", "feature_params": {"radius": 0.7, "height": 0.1, "position": [30, 20]}}, "urn:uuid:a1b87ff2-1e13-4dc8-bdca-522f47f9a18c": {"ID": "urn:uuid:a1b87ff2-1e13-4dc8-bdca-522f47f9a18c", "type": "port", "layer": "c", "feature_params": {"radius": 0.7, "height": 0.1, "position": [30, 20]}}, "urn:uuid:2865a2cd-28c5-42f3-bb0d-4cc91438fb4f": {"ID": "urn:uuid:2865a2cd-28c5-42f3-bb0d-4cc91438fb4f", "type": "channel", "layer": "c", "feature_params": {"start": [31.405, 31.02], "width": 0.41, "height": 0.1, "end": [43.31, 31.02]}}, "urn:uuid:a989e9b2-370c-4422-bfd9-47bad317246b": {"ID": "urn:uuid:a989e9b2-370c-4422-bfd9-47bad317246b", "type": "standoff", "layer": "f", "feature_params": {"radius2": 1.2, "radius1": 1.2, "height": 1.2, "position": [3, 48]}}, "urn:uuid:3ff94e71-6db9-4c97-909b-7b483d467a1a": {"ID": "urn:uuid:3ff94e71-6db9-4c97-909b-7b483d467a1a", "type": "via", "layer": "f", "feature_params": {"radius2": 0.7, "radius1": 0.8, "height": 1.0999999999999999, "position": [30, 31.02]}}, "urn:uuid:3498af49-23df-49cc-909c-8dab3d4907c7": {"ID": "urn:uuid:3498af49-23df-49cc-909c-8dab3d4907c7", "type": "via", "layer": "f", "feature_params": {"radius2": 0.7, "radius1": 0.8, "height": 1.0999999999999999, "position": [50.42, 31.02]}}, "urn:uuid:f04653e7-4656-4f2c-8124-983e927b76f4": {"ID": "urn:uuid:f04653e7-4656-4f2c-8124-983e927b76f4", "type": "port", "layer": "c", "feature_params": {"radius": 0.7, "height": 0.1, "position": [50.42, 31.02]}}, "urn:uuid:40e7709b-75c4-4eeb-901b-e2dfc3b3dffd": {"ID": "urn:uuid:40e7709b-75c4-4eeb-901b-e2dfc3b3dffd", "type": "port", "layer": "f", "feature_params": {"radius": 0.7, "height": 0.1, "position": [50.42, 20]}}, "urn:uuid:c5ac53af-fd28-40ef-b99d-ca06c129ed32": {"ID": "urn:uuid:c5ac53af-fd28-40ef-b99d-ca06c129ed32", "type": "channel", "layer": "f", "feature_params": {"start": [46.41, 31.02], "width": 0.41, "height": 0.1, "end": [46.41, 25.509999999999998]}}, "urn:uuid:82e731f3-0452-487b-b694-f33b5acff542": {"ID": "urn:uuid:82e731f3-0452-487b-b694-f33b5acff542", "type": "channel", "layer": "c", "feature_params": {"start": [31.405, 20], "width": 0.41, "height": 0.1, "end": [31.405, 31.02]}}, "urn:uuid:946d6532-cf34-4b1d-8675-d93f6b998104": {"ID": "urn:uuid:946d6532-cf34-4b1d-8675-d93f6b998104", "type": "channel", "layer": "c", "feature_params": {"start": [40.21, 28.415], "width": 0.41, "height": 0.1, "end": [46.41, 28.415]}}, "urn:uuid:b48c3cb1-3e23-4f4f-a867-c044ee6f7cf7": {"ID": "urn:uuid:b48c3cb1-3e23-4f4f-a867-c044ee6f7cf7", "type": "standoff", "layer": "f", "feature_params": {"radius2": 1.2, "radius1": 1.2, "height": 1.2, "position": [3, 3]}}, "urn:uuid:9d3c60bb-b473-4b03-a5c3-321697dce0fc": {"ID": "urn:uuid:9d3c60bb-b473-4b03-a5c3-321697dce0fc", "type": "port", "layer": "f", "feature_params": {"radius": 0.7, "height": 0.1, "position": [50.42, 31.02]}}, "urn:uuid:8b93590b-4ebe-4b93-a464-d874436e7186": {"ID": "urn:uuid:8b93590b-4ebe-4b93-a464-d874436e7186", "type": "via", "layer": "f", "feature_params": {"radius2": 0.7, "radius1": 0.8, "height": 1.0999999999999999, "position": [46.41, 25.509999999999998]}}, "urn:uuid:6781df12-2f32-4002-9604-4ec71aaed8e5": {"ID": "urn:uuid:6781df12-2f32-4002-9604-4ec71aaed8e5", "type": "via", "layer": "f", "feature_params": {"radius2": 0.7, "radius1": 0.8, "height": 1.0999999999999999, "position": [50.42, 20]}}, "urn:uuid:dfafadb4-18e0-4375-8455-a25a65acd55c": {"ID": "urn:uuid:dfafadb4-18e0-4375-8455-a25a65acd55c", "type": "standoff", "layer": "f", "feature_params": {"radius2": 1.2, "radius1": 1.2, "height": 1.2, "position": [72.8, 48]}}, "urn:uuid:9328da25-a0b7-4e25-9575-039b3bf6f556": {"ID": "urn:uuid:9328da25-a0b7-4e25-9575-039b3bf6f556", "type": "channel", "layer": "f", "feature_params": {"start": [34.010000000000005, 20], "width": 0.41, "height": 0.1, "end": [34.010000000000005, 25.509999999999998]}}, "urn:uuid:d363683a-d9ac-4980-9d88-8526d6d9dffb": {"ID": "urn:uuid:d363683a-d9ac-4980-9d88-8526d6d9dffb", "type": "channel", "layer": "c", "feature_params": {"start": [31.405, 20], "width": 0.41, "height": 0.1, "end": [47.92, 20]}}, "urn:uuid:0e110548-170e-44cd-9473-1f525ac75c1d": {"ID": "urn:uuid:0e110548-170e-44cd-9473-1f525ac75c1d", "type": "channel", "layer": "c", "feature_params": {"start": [40.21, 22.605], "width": 0.41, "height": 0.1, "end": [34.010000000000005, 22.605]}}, "urn:uuid:128bd93d-ca0f-4320-b77b-98b660ecee3c": {"ID": "urn:uuid:128bd93d-ca0f-4320-b77b-98b660ecee3c", "type": "valve", "layer": "c", "feature_params": {"radius2": 1.2, "radius1": 1.4, "height": 0.8999999999999999, "position": [40.21, 28.415]}}, "urn:uuid:6875b5c1-bd5d-4aca-86b0-97b1bdf24e22": {"ID": "urn:uuid:6875b5c1-bd5d-4aca-86b0-97b1bdf24e22", "type": "channel", "layer": "c", "feature_params": {"start": [49.015, 22.605], "width": 0.41, "height": 0.1, "end": [49.015, 28.415]}}, "urn:uuid:7d7379b5-35b4-4a53-9de0-542987c8d881": {"ID": "urn:uuid:7d7379b5-35b4-4a53-9de0-542987c8d881", "type": "valve", "layer": "c", "feature_params": {"radius2": 1.2, "radius1": 1.4, "height": 0.8999999999999999, "position": [40.21, 22.605]}}, "urn:uuid:56cdc545-3fcc-42f0-b9b9-fd3672117808": {"ID": "urn:uuid:56cdc545-3fcc-42f0-b9b9-fd3672117808", "type": "port", "layer": "c", "feature_params": {"radius": 0.7, "height": 0.1, "position": [50.42, 20]}}, "urn:uuid:80e5b6c2-87d8-4f90-a7a5-1cb4bb6d336e": {"ID": "urn:uuid:80e5b6c2-87d8-4f90-a7a5-1cb4bb6d336e", "type": "port", "layer": "f", "feature_params": {"radius": 0.7, "height": 0.1, "position": [30, 31.02]}}, "urn:uuid:9aff3255-d094-4eee-bc46-5accbb3d2f43": {"ID": "urn:uuid:9aff3255-d094-4eee-bc46-5accbb3d2f43", "type": "standoff", "layer": "f", "feature_params": {"radius2": 1.2, "radius1": 1.2, "height": 1.2, "position": [72.8, 3]}}, "urn:uuid:da122f20-5a39-4378-bf4c-43047f704138": {"ID": "urn:uuid:da122f20-5a39-4378-bf4c-43047f704138", "type": "valve", "layer": "c", "feature_params": {"radius2": 1.2, "radius1": 1.4, "height": 0.8999999999999999, "position": [43.31, 31.02]}}, "urn:uuid:68387756-9e52-412c-a91b-c67563e300ba": {"ID": "urn:uuid:68387756-9e52-412c-a91b-c67563e300ba", "type": "valve", "layer": "c", "feature_params": {"radius2": 1.2, "radius1": 1.4, "height": 0.8999999999999999, "position": [34.010000000000005, 22.605]}}, "urn:uuid:55371b2e-150b-4a80-9256-e5b8d7f96c2c": {"ID": "urn:uuid:55371b2e-150b-4a80-9256-e5b8d7f96c2c", "type": "channel", "layer": "c", "feature_params": {"start": [40.21, 22.605], "width": 0.41, "height": 0.1, "end": [49.015, 22.605]}}, "urn:uuid:cb4af447-a432-4991-a3db-d58aec3404c2": {"ID": "urn:uuid:cb4af447-a432-4991-a3db-d58aec3404c2", "type": "port", "layer": "c", "feature_params": {"radius": 0.7, "height": 0.1, "position": [34.010000000000005, 25.509999999999998]}}, "urn:uuid:48666511-d02a-4440-b901-2448de91f9f3": {"ID": "urn:uuid:48666511-d02a-4440-b901-2448de91f9f3", "type": "channel", "layer": "f", "feature_params": {"start": [30, 31.02], "width": 0.41, "height": 0.1, "end": [50.42, 31.02]}}, "urn:uuid:27f42484-b4b4-4acb-b515-d8e68e7bcd8a": {"ID": "urn:uuid:27f42484-b4b4-4acb-b515-d8e68e7bcd8a", "type": "port", "layer": "c", "feature_params": {"radius": 0.7, "height": 0.1, "position": [50.42, 22.605]}}}}');

var channel_JSON = JSON.parse('{"name":"Channel","paramTypes":{"start":"position","end":"position","width":"number","height":"number"},"handler2D":{"type":"TwoPointRectHandler","params":{"start":"start","end":"end","width":"width"}},"handler3D":{"type":"TwoPointBoxHandler","params":{"start":"start","end":"end","width":"width","height":"height"}}}');

var canvas = new fabric.CanvasWithViewport('c');

var dev = new uFab.Device({height: 50, width: 100, ID: "test_device"});
var lay = new uFab.Layer({z_offset: 0, color: "blue", ID: "layer_1"});

dev.addLayer(lay);

var makeFeatureClass = function(featureJSON){
	window[featureJSON.name] = function(featureData)
	{
		var newFeat = new uFab.Feature({
			ID: featureData.ID,
			color: featureData.color,
			type: featureJSON.name,
			paramTypes: featureJSON.paramTypes,
			handler2D: featureJSON.handler2D,
			handler3D: featureJSON.handler3D,
			params: featureData.params,
		});
		// Placeholders, figure out your naming conventions!
		newFeat.handler2DReal = new handlers[newFeat.handler2D.type](newFeat);
		newFeat.handler3DReal = new handlers[newFeat.handler3D.type](newFeat);
		return newFeat;
	}
}

makeFeatureClass(channel_JSON);

var foo = new Channel({
	params: {
		start: [0,10],
		end: [10, 20],
		width: 2,
		height: .2
	}
})
/*

var foo = new fabric.Circle(
	{
		fill: 'black',
		radius: 100,
		top: 50,
		left: 50
	});
*/

canvas.add(foo);

console.log(JSON.stringify(foo.toJSON()));